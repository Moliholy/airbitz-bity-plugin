This needs refactoring and better implementation
